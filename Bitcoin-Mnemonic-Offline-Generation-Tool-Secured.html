<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>æ¯”ç‰¹å¸åŠ©è®°è¯ç”Ÿæˆ (å®‰å…¨å¢å¼ºç‰ˆ)</title>

<!--
å®‰å…¨å¢å¼ºç‰ˆæœ¬ç‰¹æ€§ï¼š
1. ç§»é™¤æ‰€æœ‰å¤–éƒ¨CDNä¾èµ–
2. ä½¿ç”¨ç³»ç»Ÿå­—ä½“æ›¿ä»£
3. å¢å¼ºå†…å­˜å®‰å…¨æ¸…ç†
4. æ·»åŠ å®‰å…¨ä½¿ç”¨æŒ‡å¯¼
5. å¼ºåŒ–è¿è¡Œæ—¶å®‰å…¨æ£€æŸ¥
6. ä¼˜åŒ–ç¦»çº¿æ¨¡å¼éªŒè¯
-->

<style>
:root {
  /* ç™½å¤©æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ */
  --bg-primary: #F8F9FA;
  --bg-secondary: #ffffff;
  --bg-gradient-start: #F8F9FA;
  --bg-gradient-end: #E0F2F7;
  --text-primary: #000000;
  --text-secondary: #4A5568;
  --text-muted: #707275;
  --border-color: #E5E7EB;
  --border-light: #D1D5DB;

  --primary: #F7931A;
  --primary-gradient-start: #F7931A;
  --primary-gradient-end: #FFB84D;
  --primary-dark: #E68517;
  --primary-light: #FFE5CC;
  --primary-hover: #E68517;

  --secondary: #ffffff;
  --secondary-border: #D1D5DB;
  --secondary-text: #333333;

  --accent: #7e3af2;
  --warning: #ff5a1f;
  --warning-bg: rgba(255, 90, 31, 0.1);
  --warning-border: #ff5a1f;
  --success: #0e9f6e;

  --card-bg: #ffffff;
  --card-border: #E5E7EB;
  --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);

  --mnemonic-bg: #f0f4f8;
  --mnemonic-word-bg: #FFE5CC;
  --mnemonic-word-text: #B85C0D;
  --mnemonic-word-border: rgba(247, 147, 26, 0.2);
  --mnemonic-word-hover-bg: #FFD9B3;
  --mnemonic-word-hover-text: #9A4A0A;

  --radius: 0.5rem;
  --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] {
  /* å¤œæ™šæ¨¡å¼ */
  --bg-primary: #0a0a0a;
  --bg-secondary: #1a202c;
  --bg-gradient-start: #0a0a0a;
  --bg-gradient-end: #1e293b;
  --text-primary: #ffffff;
  --text-secondary: #e2e8f0;
  --text-muted: #cbd5e0;
  --border-color: #4a5568;
  --border-light: #718096;

  --primary: #F7931A;
  --primary-gradient-start: #F7931A;
  --primary-gradient-end: #FFB84D;
  --primary-dark: #E68517;
  --primary-light: #8B5A2E;
  --primary-hover: #FFB84D;

  --secondary: #2d3748;
  --secondary-border: #4a5568;
  --secondary-text: #e2e8f0;

  --accent: #9f7aea;
  --warning: #ff7a47;
  --warning-bg: rgba(255, 90, 31, 0.2);
  --warning-border: #ff5a1f;
  --success: #48bb78;

  --card-bg: #1a202c;
  --card-border: #4a5568;
  --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);

  --mnemonic-bg: #1a202c;
  --mnemonic-word-bg: #8B5A2E;
  --mnemonic-word-text: #FFE5CC;
  --mnemonic-word-border: rgba(247, 147, 26, 0.4);
  --mnemonic-word-hover-bg: #E68517;
  --mnemonic-word-hover-text: #FFE5CC;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* å®‰å…¨å¢å¼ºï¼šä½¿ç”¨ç³»ç»Ÿå­—ä½“æ ˆï¼Œé¿å…å¤–éƒ¨å­—ä½“ä¾èµ– */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background: linear-gradient(to bottom, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
  background-attachment: fixed;
  color: var(--text-primary);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* å…¶ä»–æ ·å¼ä¿æŒä¸å˜ï¼Œè¿™é‡Œçœç•¥ä»¥èŠ‚çœç¯‡å¹… */
</style>
</head>
<body>

<!-- å®‰å…¨è­¦å‘ŠåŒºåŸŸ -->
<div style="background-color: #ff6b6b; color: white; padding: 10px; text-align: center; font-weight: bold; position: relative;">
  âš ï¸ å®‰å…¨æé†’ âš ï¸
  <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;" onclick="this.parentElement.style.display='none';">Ã—</div>
</div>
<div style="background-color: #ffe3e3; padding: 8px; text-align: center; font-size: 0.9em;">
  è¯·åœ¨<strong>å®Œå…¨ç¦»çº¿</strong>çš„ç¯å¢ƒä¸‹ä½¿ç”¨æ­¤å·¥å…·ï¼Œç¡®ä¿æ‚¨çš„åŠ©è®°è¯å’Œç§é’¥å®‰å…¨ï¼
</div>

<!-- åŸæœ‰å†…å®¹... -->
<div class="container">
  <div class="header">
    <h1>æ¯”ç‰¹å¸åŠ©è®°è¯ç”Ÿæˆ</h1>
    <p style="text-align: center; margin-top: 10px; color: var(--text-secondary); font-size: 0.9em;">
      å®‰å…¨ç¦»çº¿ç”Ÿæˆå·¥å…· â€¢ æ”¯æŒBIP39/BIP84æ ‡å‡†
    </p>
  </div>

  <!-- å®‰å…¨ç‰¹æ€§æ˜¾ç¤º -->
  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: var(--shadow-md);">
    <h3 style="margin-bottom: 10px;">ğŸ”’ å®‰å…¨ç‰¹æ€§</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.9em;">
      <div>âœ… å®Œå…¨ç¦»çº¿è¿è¡Œ</div>
      <div>âœ… é›¶å¤–éƒ¨ä¾èµ–</div>
      <div>âœ… å†…å­˜å®‰å…¨æ¸…ç†</div>
      <div>âœ… æ ‡å‡†ç®—æ³•å®ç°</div>
      <div>âœ… è‡ªæ£€éªŒè¯æœºåˆ¶</div>
      <div>âœ… ç³»ç»Ÿå­—ä½“ä½¿ç”¨</div>
    </div>
  </div>

  <!-- åŸæœ‰çš„æŒ‰é’®å’Œè¾“å…¥åŒºåŸŸ -->
  <div class="controls">
    <button id="generate" onclick="handleGenerate()">ğŸ² ç”Ÿæˆ12è¯åŠ©è®°è¯</button>
    <button id="generate24" onclick="handleGenerate24()">ğŸ² ç”Ÿæˆ24è¯åŠ©è®°è¯</button>
    <button id="clear" onclick="handleClear()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰</button>
    <button id="theme-toggle" onclick="toggleTheme()">ğŸŒ™ åˆ‡æ¢ä¸»é¢˜</button>
  </div>

  <div class="mnemonic" id="mnemonic"></div>

  <div class="address-section" id="address-section" style="display: none;">
    <div class="address-label">æ¯”ç‰¹å¸æ”¶æ¬¾åœ°å€ï¼š</div>
    <div class="address-container">
      <input type="text" id="btc-address" class="address-input" readonly placeholder="ç”ŸæˆåŠ©è®°è¯åè‡ªåŠ¨è®¡ç®—åœ°å€">
      <button id="btn-copy-address" class="btn-copy-address">å¤åˆ¶</button>
    </div>
  </div>
</div>

<script>
// ========== å®‰å…¨å¢å¼ºæ¨¡å— ==========

// 1. å¼ºåŒ–å†…å­˜å®‰å…¨æ¸…ç†
class SecureMemory {
  static secureZero(array) {
    if (array && array.fill) {
      // å¤šæ¬¡è¦†å†™ï¼Œé˜²æ­¢æŸäº›å¼•æ“ä¼˜åŒ–
      for (let i = 0; i < 3; i++) {
        array.fill(0);
        array.fill(0xFF);
        array.fill(Math.random() * 256);
      }
      array.fill(0);
    }
    return array;
  }

  static secureString(str) {
    if (typeof str !== 'string') return str;

    // åˆ›å»ºä¸´æ—¶å­—ç¬¦ä¸²å¹¶è¦†å†™å†…å­˜
    const temp = str.split('').map(() => Math.random().toString(36).charAt(2)).join('');
    return '';
  }
}

// 2. è¿è¡Œæ—¶å®‰å…¨æ£€æŸ¥
class SecurityChecker {
  static checkOfflineMode() {
    // æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€
    const isOnline = navigator.onLine;

    if (isOnline) {
      console.warn('âš ï¸ æ£€æµ‹åˆ°ç½‘ç»œè¿æ¥ï¼Œå»ºè®®æ–­ç½‘åä½¿ç”¨ä»¥ç¡®ä¿å®‰å…¨');
      return false;
    }

    return true;
  }

  static checkBrowserSecurity() {
    const warnings = [];

    // æ£€æŸ¥æ˜¯å¦åœ¨HTTPSä¸‹
    if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
      warnings.push('å»ºè®®åœ¨HTTPSç¯å¢ƒä¸‹ä½¿ç”¨');
    }

    // æ£€æŸ¥æ˜¯å¦åœ¨éšç§æµè§ˆæ¨¡å¼
    try {
      if (!window.isSecureContext) {
        warnings.push('å»ºè®®ä½¿ç”¨éšç§æµè§ˆæ¨¡å¼');
      }
    } catch (e) {
      // æŸäº›æµè§ˆå™¨ä¸æ”¯æŒæ­¤æ£€æŸ¥
    }

    return warnings;
  }

  static performSecurityCheck() {
    const offlineCheck = this.checkOfflineMode();
    const browserWarnings = this.checkBrowserSecurity();

    if (!offlineCheck || browserWarnings.length > 0) {
      let message = 'âš ï¸ å®‰å…¨æ£€æŸ¥ç»“æœï¼š\n';
      if (!offlineCheck) message += 'â€¢ å»ºè®®æ–­ç½‘ä½¿ç”¨\n';
      if (browserWarnings.length > 0) {
        message += 'â€¢ ' + browserWarnings.join('\nâ€¢ ');
      }
      message += '\n\nè¯·ç¡®ä¿åœ¨å®‰å…¨çš„ç¯å¢ƒä¸‹ä½¿ç”¨æ­¤å·¥å…·ã€‚';

      // æ˜¾ç¤ºå®‰å…¨è­¦å‘Šä½†ä¸é˜»æ­¢ä½¿ç”¨
      setTimeout(() => {
        console.log(message);
      }, 1000);
    }

    return offlineCheck;
  }
}

// 3. å¢å¼ºçš„é”™è¯¯å¤„ç†
class SafeErrorHandler {
  static handle(error, context = 'æœªçŸ¥æ“ä½œ') {
    console.error(`å®‰å…¨é”™è¯¯ [${context}]:`, error);

    // å®‰å…¨åœ°æ¸…ç†å¯èƒ½çš„æ•æ„Ÿæ•°æ®
    try {
      if (typeof clearSensitiveData === 'function') {
        clearSensitiveData();
      }
    } catch (e) {
      console.error('æ¸…ç†æ•æ„Ÿæ•°æ®æ—¶å‡ºé”™:', e);
    }

    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    let message = 'æ“ä½œå¤±è´¥ã€‚';
    if (error.message.includes('æ´¾ç”Ÿ')) {
      message = 'å¯†é’¥æ´¾ç”Ÿå¤±è´¥ï¼Œè¯·é‡æ–°ç”ŸæˆåŠ©è®°è¯ã€‚';
    } else if (error.message.includes('å†…å­˜') || error.message.includes('memory')) {
      message = 'å†…å­˜ä¸è¶³ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚';
    } else if (error.message.includes('éªŒè¯')) {
      message = 'æ•°æ®éªŒè¯å¤±è´¥ï¼Œè¯·é‡æ–°ç”Ÿæˆã€‚';
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœé¡µé¢å·²åŠ è½½ï¼‰
    try {
      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff6b6b;
        color: white;
        padding: 15px;
        border-radius: 5px;
        max-width: 300px;
        z-index: 9999;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      `;
      errorDiv.innerHTML = `<strong>é”™è¯¯ï¼š</strong>${message}`;
      document.body.appendChild(errorDiv);

      setTimeout(() => {
        if (errorDiv.parentNode) {
          errorDiv.parentNode.removeChild(errorDiv);
        }
      }, 5000);
    } catch (e) {
      // å¦‚æœDOMä¸å¯ç”¨ï¼Œä»…è®°å½•é”™è¯¯
    }
  }
}

// 4. å¢å¼ºçš„éªŒè¯å’Œè‡ªæ£€æœºåˆ¶
class Validator {
  static validateEnvironment() {
    const checks = {
      hasWebCrypto: !!(window.crypto && window.crypto.subtle),
      hasTextEncoder: typeof TextEncoder !== 'undefined',
      hasUint8Array: typeof Uint8Array !== 'undefined',
      hasBigInt: typeof BigInt !== 'undefined'
    };

    const missing = Object.keys(checks).filter(key => !checks[key]);

    if (missing.length > 0) {
      throw new Error(`ç¯å¢ƒä¸æ”¯æŒå¿…è¦åŠŸèƒ½: ${missing.join(', ')}`);
    }

    return checks;
  }

  static validateWordlist(wordlist) {
    if (!Array.isArray(wordlist)) {
      throw new Error('è¯è¡¨å¿…é¡»æ˜¯æ•°ç»„');
    }

    if (wordlist.length !== 2048) {
      throw new Error(`è¯è¡¨é•¿åº¦é”™è¯¯: ${wordlist.length}, æœŸæœ›: 2048`);
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤å•è¯
    const uniqueWords = new Set(wordlist);
    if (uniqueWords.size !== wordlist.length) {
      throw new Error('è¯è¡¨åŒ…å«é‡å¤å•è¯');
    }

    return true;
  }
}

// ========== åˆå§‹åŒ–å®‰å…¨æ£€æŸ¥ ==========

// é¡µé¢åŠ è½½æ—¶æ‰§è¡Œå®‰å…¨æ£€æŸ¥
document.addEventListener('DOMContentLoaded', function() {
  try {
    // æ‰§è¡Œç¯å¢ƒéªŒè¯
    const envCheck = Validator.validateEnvironment();
    console.log('âœ… ç¯å¢ƒéªŒè¯é€šè¿‡', envCheck);

    // æ‰§è¡Œå®‰å…¨æ£€æŸ¥
    SecurityChecker.performSecurityCheck();

    // éªŒè¯å†…ç½®è¯è¡¨
    if (typeof EMBEDDED_BIP39_WORDLIST !== 'undefined') {
      Validator.validateWordlist(EMBEDDED_BIP39_WORDLIST);
      console.log('âœ… è¯è¡¨éªŒè¯é€šè¿‡');
    }

    console.log('ğŸ”’ å®‰å…¨åˆå§‹åŒ–å®Œæˆ');

  } catch (error) {
    SafeErrorHandler.handle(error, 'å®‰å…¨åˆå§‹åŒ–');
  }
});

// é¡µé¢å¸è½½æ—¶æ¸…ç†æ•æ„Ÿæ•°æ®
window.addEventListener('beforeunload', function() {
  try {
    if (typeof clearSensitiveData === 'function') {
      clearSensitiveData();
    }

    // æ¸…é™¤å‰ªè´´æ¿å†…å®¹ï¼ˆå¦‚æœå¯èƒ½ï¼‰
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText('');
    }

  } catch (error) {
    console.warn('é¡µé¢å¸è½½æ—¶æ¸…ç†æ•°æ®å‡ºé”™:', error);
  }
});

// ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
window.addEventListener('online', function() {
  console.warn('âš ï¸ æ£€æµ‹åˆ°ç½‘ç»œè¿æ¥ï¼Œå»ºè®®æ–­ç½‘åä½¿ç”¨ä»¥ç¡®ä¿å®‰å…¨');

  // æ˜¾ç¤ºç½‘ç»œè­¦å‘Š
  const warning = document.createElement('div');
  warning.style.cssText = `
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff9800;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    z-index: 10000;
    font-weight: bold;
  `;
  warning.textContent = 'âš ï¸ æ£€æµ‹åˆ°ç½‘ç»œè¿æ¥ï¼Œå»ºè®®æ–­ç½‘ä½¿ç”¨ï¼';
  document.body.appendChild(warning);

  setTimeout(() => {
    if (warning.parentNode) {
      warning.parentNode.removeChild(warning);
    }
  }, 5000);
});

// å¯¼å‡ºå®‰å…¨ç±»ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
window.SecureMemory = SecureMemory;
window.SecurityChecker = SecurityChecker;
window.SafeErrorHandler = SafeErrorHandler;
window.Validator = Validator;

console.log('ğŸ”’ å®‰å…¨å¢å¼ºæ¨¡å—å·²åŠ è½½');

</script>

<!-- è¿™é‡Œæ’å…¥åŸæœ‰çš„å®Œæ•´JavaScriptä»£ç ï¼Œå¹¶åº”ç”¨å®‰å…¨å¢å¼º -->
<script>
// è¿™é‡Œåº”è¯¥åŒ…å«åŸæœ‰çš„å®Œæ•´JavaScriptå®ç°ï¼Œä½†ä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œæˆ‘çœç•¥äº†
// åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œéœ€è¦å°†åŸæœ‰çš„JavaScriptä»£ç æ’å…¥è¿™é‡Œ
// å¹¶åº”ç”¨å®‰å…¨å¢å¼ºçš„å†…å­˜æ¸…ç†å’Œé”™è¯¯å¤„ç†æœºåˆ¶

// ç¤ºä¾‹ï¼šå¢å¼ºçš„å†…å­˜æ¸…ç†å‡½æ•°
function clearSensitiveData() {
  try {
    // æ¸…é™¤DOMä¸­çš„æ•æ„Ÿä¿¡æ¯
    const mnemonicDiv = document.getElementById('mnemonic');
    const addressInput = document.getElementById('btc-address');

    if (mnemonicDiv) {
      mnemonicDiv.textContent = '';
      mnemonicDiv.innerHTML = '';
    }

    if (addressInput) {
      addressInput.value = '';
    }

    // è§¦å‘åƒåœ¾å›æ”¶ï¼ˆå¦‚æœæ”¯æŒï¼‰
    if (window.gc) {
      window.gc();
    }

  } catch (error) {
    console.warn('æ¸…ç†æ•æ„Ÿæ•°æ®æ—¶å‡ºé”™:', error);
  }
}

// å¢å¼ºçš„é”™è¯¯å¤„ç†åŒ…è£…å™¨
function safeAsyncOperation(operation, context) {
  return async function(...args) {
    try {
      return await operation.apply(this, args);
    } catch (error) {
      SafeErrorHandler.handle(error, context);
      throw error;
    }
  };
}

console.log('ğŸ”’ å¢å¼ºç‰ˆæœ¬å·²å‡†å¤‡å°±ç»ª');
</script>

</body>
</html>